<!DOCTYPE html>
<html lang="cs">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Tabata Timer PRO</title>

<style>
body{
  margin:0;font-family:Arial;background:#111;color:#fff;
  display:flex;justify-content:center;align-items:center;height:100vh
}
.app{
  background:#1e1e1e;padding:25px;border-radius:14px;width:380px;text-align:center
}
input,select{
  width:90px;padding:6px;margin:4px;text-align:center
}
button{
  padding:10px 14px;margin:6px;font-size:15px;cursor:pointer
}
#time{font-size:56px;margin:10px 0}
#phase{font-size:22px}
#round{font-size:16px;opacity:.8}
</style>
</head>

<body>
<div class="app" id="app">
<h2>Tabata Timer PRO</h2>

<select onchange="applyPreset(this.value)">
  <option value="">â€” Preset â€”</option>
  <option value="tabata">Tabata 20/10 Ã—8</option>
  <option value="hiit">HIIT 30/15 Ã—10</option>
  <option value="circuit">KruhÃ¡Ä 45/15 Ã—12</option>
  <option value="stretch">Stretch 30/10 Ã—5</option>
</select>

<div><label>PÅ™Ã­prava</label><br><input id="prep" type="number" value="10"></div>
<div><label>CviÄenÃ­</label><br><input id="work" type="number" value="20"></div>
<div><label>OdpoÄinek</label><br><input id="rest" type="number" value="10"></div>
<div><label>Kola</label><br><input id="rounds" type="number" value="8"></div>

<div id="phase">PÅ™ipraven</div>
<div id="time">00:00</div>
<div id="round"></div>

<button onclick="start()">Start</button>
<button onclick="pause()">Pauza</button>
<button onclick="reset()">Reset</button>
<button onclick="toggleFullscreen()">Full-screen</button>

<p style="font-size:12px;opacity:.6">
ğŸ™ï¸ hlasem: â€startâ€œ, â€pauzaâ€œ, â€pokraÄujâ€œ, â€resetâ€œ
</p>
</div>

<script>
let timer,running=false,phase="prep",remaining=0,currentRound=1,countdown=false;
const app=document.getElementById("app");
const phaseEl=phaseEl||document.getElementById("phase");
const timeEl=document.getElementById("time");
const roundEl=document.getElementById("round");

function beep(f,d=200){
  const c=new AudioContext(),o=c.createOscillator(),g=c.createGain();
  o.frequency.value=f;o.connect(g);g.connect(c.destination);o.start();
  setTimeout(()=>{o.stop();c.close()},d);
}
function speak(t){
  speechSynthesis.speak(new SpeechSynthesisUtterance(t));
}

function applyPreset(p){
  const presets={
    tabata:[10,20,10,8],
    hiit:[10,30,15,10],
    circuit:[10,45,15,12],
    stretch:[10,30,10,5]
  };
  if(!presets[p])return;
  [prep.value,work.value,rest.value,rounds.value]=presets[p];
  save();
}

function save(){
  localStorage.setItem("tabata",JSON.stringify({
    prep:prep.value,work:work.value,rest:rest.value,rounds:rounds.value
  }));
}
(function load(){
  const s=JSON.parse(localStorage.getItem("tabata")); if(!s)return;
  prep.value=s.prep;work.value=s.work;rest.value=s.rest;rounds.value=s.rounds;
})();

function start(){
  if(running)return;
  save(); running=true;
  if(!remaining){ phase="prep"; remaining=+prep.value; currentRound=1; }
  run();
}

function run(){
timer=setInterval(()=>{
  remaining--;
  if(remaining<=0){
    if(phase==="prep"||phase==="rest"){
      countdown321(()=>{phase="work";remaining=+work.value;});
      return;
    }
    if(phase==="work"){
      if(currentRound>=+rounds.value){finish();return;}
      phase="rest";remaining=+rest.value;currentRound++;
    }
  }
  update();
},1000);
}

function countdown321(cb){
  clearInterval(timer);
  countdown=true;
  let n=3;
  speak("TÅ™i");
  const cd=setInterval(()=>{
    timeEl.textContent=n;
    beep(700);
    if(n===2)speak("Dva");
    if(n===1)speak("Jedna");
    n--;
    if(n<0){
      clearInterval(cd);
      countdown=false;
      speak("Start");
      cb(); update(); run();
    }
  },1000);
}

function pause(){
  if(!running)return;
  clearInterval(timer); running=false; speak("Pauza");
}
function reset(){
  clearInterval(timer); running=false; remaining=0; phase="prep"; currentRound=1;
  phaseEl.textContent="PÅ™ipraven"; timeEl.textContent="00:00"; roundEl.textContent="";
  app.style.background="#1e1e1e";
}
function finish(){
  clearInterval(timer); running=false; speak("Hotovo"); beep(1200,600);
  phaseEl.textContent="Hotovo ğŸ’ª";
}

function update(){
  const c={prep:"#1565c0",work:"#2e7d32",rest:"#c62828"};
  app.style.background=c[phase];
  phaseEl.textContent=phase==="prep"?"PÅ™Ã­prava":phase==="work"?"CviÄenÃ­":"OdpoÄinek";
  roundEl.textContent=phase!=="prep"?`Kolo ${currentRound}/${rounds.value}`:"";
  timeEl.textContent=String(Math.floor(remaining/60)).padStart(2,"0")+":"+String(remaining%60).padStart(2,"0");
}

function toggleFullscreen(){
  document.fullscreenElement?document.exitFullscreen():document.documentElement.requestFullscreen();
}

/* ğŸ™ï¸ VOICE COMMANDS */
const SR=window.SpeechRecognition||window.webkitSpeechRecognition;
if(SR){
  const rec=new SR();
  rec.lang="cs-CZ"; rec.continuous=true;
  rec.onresult=e=>{
    const t=e.results[e.results.length-1][0].transcript.toLowerCase();
    if(t.includes("start"))start();
    if(t.includes("pauza"))pause();
    if(t.includes("pokraÄuj"))start();
    if(t.includes("reset"))reset();
    if(t.includes("fullscreen"))toggleFullscreen();
  };
  document.body.addEventListener("click",()=>rec.start(),{once:true});
}
</script>
</body>
</html>
