<!DOCTYPE html>
<html lang="cs">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Tabata Timer PRO</title>

<style>
body{
  margin:0;font-family:Arial;background:#111;color:#fff;
  display:flex;justify-content:center;align-items:center;height:100vh
}
.app{
  background:#1e1e1e;padding:22px;border-radius:14px;width:390px;text-align:center
}
input,select{
  width:95px;padding:6px;margin:4px;text-align:center
}
button{
  padding:9px 14px;margin:5px;font-size:14px;cursor:pointer
}
#time{font-size:56px;margin:10px 0}
#phase{font-size:22px}
#round{font-size:15px;opacity:.8}
.small{font-size:12px;opacity:.6}
</style>
</head>

<body>
<div class="app" id="app">
<h2>Tabata Timer PRO</h2>

<select id="presetSelect" onchange="loadPreset(this.value)">
  <option value="">â€” Preset â€”</option>
</select>
<br>
<button onclick="saveCustomPreset()">ğŸ’¾ UloÅ¾it preset</button>

<div><label>PÅ™Ã­prava</label><br><input id="prep" type="number" value="10"></div>
<div><label>CviÄenÃ­</label><br><input id="work" type="number" value="20"></div>
<div><label>OdpoÄinek</label><br><input id="rest" type="number" value="10"></div>
<div><label>Kola</label><br><input id="rounds" type="number" value="8"></div>

<div id="phase">PÅ™ipraven</div>
<div id="time">00:00</div>
<div id="round"></div>

<button onclick="start()">Start</button>
<button onclick="pause()">Pauza</button>
<button onclick="reset()">Reset</button>
<button onclick="toggleFullscreen()">Full-screen</button>

<p class="small">
ğŸ™ï¸ hlas: â€CviÄenÃ­â€œ, â€Pauzaâ€œ, â€3â€“2â€“1â€œ<br>
ğŸ¤ povely: start / pauza / pokraÄuj / reset
</p>
</div>

<script>
let timer,running=false,phase="prep",remaining=0,currentRound=1;
const app=document.getElementById("app");
const phaseEl=document.getElementById("phase");
const timeEl=document.getElementById("time");
const roundEl=document.getElementById("round");
const presetSelect=document.getElementById("presetSelect");

/* ğŸ”Š AUDIO */
function beep(f,d=200){
  const c=new AudioContext(),o=c.createOscillator(),g=c.createGain();
  o.frequency.value=f;o.connect(g);g.connect(c.destination);o.start();
  setTimeout(()=>{o.stop();c.close()},d);
}
function speak(t){
  speechSynthesis.speak(new SpeechSynthesisUtterance(t));
}

/* ğŸ§© PRESETY */
const builtInPresets={
  "Tabata 20/10 Ã—8":[10,20,10,8],
  "HIIT 30/15 Ã—10":[10,30,15,10],
  "KruhÃ¡Ä 45/15 Ã—12":[10,45,15,12],
  "Stretch 30/10 Ã—5":[10,30,10,5],
  "EMOM 60 Ã—10":[10,60,0,10],
  "SilovÃ½ blok 40/20 Ã—6":[10,40,20,6]
};

function initPresets(){
  presetSelect.innerHTML='<option value="">â€” Preset â€”</option>';
  Object.keys(builtInPresets).forEach(p=>{
    presetSelect.innerHTML+=`<option value="b:${p}">${p}</option>`;
  });
  const custom=JSON.parse(localStorage.getItem("customPresets")||"{}");
  Object.keys(custom).forEach(p=>{
    presetSelect.innerHTML+=`<option value="c:${p}">â­ ${p}</option>`;
  });
}
initPresets();

function loadPreset(v){
  if(!v)return;
  let data;
  if(v.startsWith("b:")) data=builtInPresets[v.slice(2)];
  else data=JSON.parse(localStorage.getItem("customPresets"))[v.slice(2)];
  [prep.value,work.value,rest.value,rounds.value]=data;
}

function saveCustomPreset(){
  const name=prompt("NÃ¡zev presetu:");
  if(!name)return;
  const custom=JSON.parse(localStorage.getItem("customPresets")||"{}");
  custom[name]=[+prep.value,+work.value,+rest.value,+rounds.value];
  localStorage.setItem("customPresets",JSON.stringify(custom));
  initPresets();
}

/* â±ï¸ TIMER */
function start(){
  if(running)return;
  running=true;
  if(!remaining){phase="prep";remaining=+prep.value;currentRound=1;}
  run();
}
function run(){
  timer=setInterval(()=>{
    if(remaining<=3 && remaining>0){
      speak(["","Jedna","Dva","TÅ™i"][remaining]);
    }
    remaining--;
    if(remaining<0){
      if(phase==="prep"){phase="work";remaining=+work.value;speak("CviÄenÃ­");}
      else if(phase==="work"){
        if(currentRound>=+rounds.value){finish();return;}
        phase="rest";remaining=+rest.value;currentRound++;speak("Pauza");
      }else{
        phase="work";remaining=+work.value;speak("CviÄenÃ­");
      }
    }
    update();
  },1000);
}

function pause(){
  if(!running)return;
  clearInterval(timer);running=false;speak("Pauza");
}
function reset(){
  clearInterval(timer);running=false;remaining=0;phase="prep";currentRound=1;
  phaseEl.textContent="PÅ™ipraven";timeEl.textContent="00:00";roundEl.textContent="";
  app.style.background="#1e1e1e";
}
function finish(){
  clearInterval(timer);running=false;speak("Hotovo");beep(1200,600);
  phaseEl.textContent="Hotovo ğŸ’ª";
}
function update(){
  const c={prep:"#1565c0",work:"#2e7d32",rest:"#c62828"};
  app.style.background=c[phase];
  phaseEl.textContent=phase==="prep"?"PÅ™Ã­prava":phase==="work"?"CviÄenÃ­":"OdpoÄinek";
  roundEl.textContent=phase!=="prep"?`Kolo ${currentRound}/${rounds.value}`:"";
  timeEl.textContent=String(Math.floor(Math.max(remaining,0)/60)).padStart(2,"0")+":"+String(Math.max(remaining,0)%60).padStart(2,"0");
}

/* ğŸ™ï¸ VOICE COMMANDS */
const SR=window.SpeechRecognition||window.webkitSpeechRecognition;
if(SR){
  const rec=new SR();
  rec.lang="cs-CZ";rec.continuous=true;
  rec.onresult=e=>{
    const t=e.results[e.results.length-1][0].transcript.toLowerCase();
    if(t.includes("start"))start();
    if(t.includes("pauza"))pause();
    if(t.includes("pokraÄuj"))start();
    if(t.includes("reset"))reset();
  };
  document.body.addEventListener("click",()=>rec.start(),{once:true});
}

function toggleFullscreen(){
  document.fullscreenElement?document.exitFullscreen():document.documentElement.requestFullscreen();
}
</script>
</body>
</html>
